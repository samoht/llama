configure_options="$*"
prefix=/usr/local

# Parse command-line arguments

while : ; do
  case "$1" in
    "") break;;
    -prefix|--prefix)
        prefix=$2; shift;;
    *) echo "Unknown option \"$1\"." 1>&2; exit 2;;
  esac
  shift
done

# Sanity checks

case "$prefix" in
  /*) ;;
   *) echo "The -prefix directory must be absolute." 1>&2; exit 2;;
esac

# Generate the files

rm -f config.mk
touch config.mk

# Write options to Makefile

echo "# generated by ./configure $configure_options" >> config.mk

# Where to install

echo "PREFIX=$prefix" >> config.mk
echo 'BINDIR=$(PREFIX)/bin' >> config.mk
bindir="$prefix/bin"
echo 'LIBDIR=$(PREFIX)/lib/llama' >> config.mk
libdir="$prefix/lib/llama"
echo 'MANDIR=$(PREFIX)/man' >> config.mk
mandir="$prefix/man"
echo "MANEXT=1" >> config.mk

# Configure the back-system

cd back && ./configure -prefix $prefix
